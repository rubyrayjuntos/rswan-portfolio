<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Neumorphic Portfolio SPA For Ray Swan - rs@RSwan.org</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Decap CMS -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        /* Define CSS Variables for Neumorphic Theme */
        :root {
            --bg-color: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --text-color: #31456A;
            --text-color-light: #6D82A2;
            --accent-color: #5a67d8;
            --accent-secondary: #f093fb;
            --accent-tertiary: #f5576c;
            --scroll-bar-color: #c8d0e7;
            --scroll-thumb-color: #a3b1c6;
            --featured-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --featured-text: #ffffff;
        }

        /* Smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }

        /* Base Body Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-light);
            margin: 0;
            -webkit-font-smoothing: antialiased; /* Smoother font rendering */
            -moz-osx-font-smoothing: grayscale; /* Smoother font rendering */
        }
        
        /* Custom Scrollbar Styling for Webkit Browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scroll-bar-color);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--scroll-thumb-color);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-color);
        }

        /* General View Container Styles */
        .view {
            padding: 2rem;
            box-sizing: border-box;
            min-height: 100vh; /* Ensure view takes full height */
        }

        /* --- GALLERY VIEW STYLES --- */
        #gallery-view .portfolio-container {
            display: grid;
            grid-template-columns: 300px 1fr; /* Default desktop layout */
            gap: 2.5rem;
            height: calc(100vh - 4rem); /* Full viewport height minus padding */
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Responsive adjustments for portfolio container */
        @media (max-width: 1024px) {
            #gallery-view .portfolio-container {
                grid-template-columns: 1fr; /* Stack sidebar and gallery on smaller screens */
                height: auto; /* Allow height to adjust to content */
            }
            
            .filter-sidebar {
                height: auto;
                position: sticky;
                top: 2rem;
                z-index: 10;
            }
            
            .project-card.featured,
            .project-card.wide {
                grid-column: span 1;
            }
            
            .case-study-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .case-study-nav {
                position: static;
            }
        }

        .filter-sidebar {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 9px 9px 16px var(--shadow-dark), -9px -9px 16px var(--shadow-light);
            overflow-y: auto; /* Enable scrolling for long filter lists */
            height: 100%; /* Take full height of grid cell */
            display: flex; /* Use flexbox for search and filters */
            flex-direction: column;
        }

        @media (max-width: 1024px) {
            .filter-sidebar {
                height: auto; /* Auto height on smaller screens */
                margin-bottom: 2rem; /* Spacing when stacked */
            }
        }

        .sidebar-header {
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--scroll-bar-color);
        }
        .sidebar-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            color: var(--text-color);
            margin: 0;
            cursor: pointer;
            transition: color 0.2s ease;
            font-weight: 700;
        }
        .sidebar-header h1:hover {
            color: var(--accent-color);
        }
        .sidebar-header p {
            margin: 0.25rem 0 0 0;
            font-size: 1rem;
            color: var(--accent-color);
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .sidebar-header p:hover {
            text-decoration: underline;
        }

        .filter-sidebar h2 {
            color: var(--text-color);
            text-align: center;
            margin: 0 0 1.5rem 0;
            font-weight: 600;
            font-size: 1.25rem;
        }

        /* Natural Language Search Section */
        .search-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--scroll-bar-color);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .neumorphic-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: box-shadow 0.2s ease;
            box-sizing: border-box; /* Include padding in width */
        }
        .neumorphic-input::placeholder {
            color: var(--text-color-light);
        }
        .neumorphic-input:focus {
            box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light), 0 0 0 2px var(--accent-color);
        }

        .neumorphic-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            background: var(--bg-color);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
            outline: none;
        }
        .neumorphic-button:hover {
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
            color: var(--accent-color);
        }
        .neumorphic-button:active {
            box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
        }
        .neumorphic-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
        }

        #search-loading {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-top: 1rem;
        }

        .guided-results-container {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .guided-search-pill {
            display: inline-flex;
            align-items: center;
            padding: 0.6rem 1.2rem;
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            font-size: 0.9rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .guided-search-pill:hover {
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
            color: var(--accent-color);
        }
        .guided-search-pill:active {
            box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
        }

        /* Facet Group Styles (rest of the sidebar) */
        .facet-group {
            margin-bottom: 1rem;
            border: none;
            padding: 0;
            border-radius: 10px;
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
            flex-shrink: 0; /* Prevent from shrinking too much in flex container */
        }

        .facet-group summary {
            font-weight: 600;
            color: var(--text-color);
            padding: 1rem;
            cursor: pointer;
            list-style: none; /* Hide default marker */
            position: relative;
        }
        
        /* Custom details marker for facet groups */
        .facet-group summary::-webkit-details-marker { display: none; }
        .facet-group summary::after {
            content: '+';
            position: absolute;
            right: 1rem;
            font-size: 1.5rem;
            transition: transform 0.2s ease;
        }
        .facet-group[open] > summary::after { transform: rotate(45deg); } /* Rotate icon when open */
        .facet-content { padding: 0 1rem 1rem 1rem; }
        .facet-group ul { list-style: none; padding: 0; margin: 0; }
        .facet-group li { margin-bottom: 0.75rem; }

        /* Neumorphic Checkbox/Radio Controls */
        .neumorphic-control {
            display: flex; align-items: center; cursor: pointer;
            padding: 4px; border-radius: 8px; transition: all 0.2s ease-in-out;
        }
        .neumorphic-control:hover { background-color: #d1d9e6; } /* Subtle hover effect */
        .neumorphic-control input { display: none; } /* Hide native input */
        .neumorphic-control .checkmark {
            display: inline-block; width: 20px; height: 20px; background: var(--bg-color);
            border-radius: 5px; margin-right: 12px;
            box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
            position: relative; transition: box-shadow 0.2s ease-in-out;
        }
        .neumorphic-control input:checked + .checkmark { box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light); } /* 'Pressed' state */
        .neumorphic-control input:checked + .checkmark::after {
            content: '✔'; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); color: var(--accent-color);
            font-size: 14px; font-weight: bold;
        }
        /* Radio button specific styles */
        .neumorphic-control input[type="radio"] + .checkmark { border-radius: 50%; }
        .neumorphic-control input[type="radio"]:checked + .checkmark::after {
            content: ''; width: 10px; height: 10px;
            background: var(--accent-color); border-radius: 50%;
        }
        .facet-count {
            margin-left: auto; font-size: 0.8rem; background-color: #d1d9e6;
            padding: 2px 6px; border-radius: 4px; color: var(--text-color-light);
        }

        /* Neumorphic Slider Styles */
        .slider-container { padding: 0.5rem 0; }
        .slider-label { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 0.5rem; }
        .neumorphic-slider {
            -webkit-appearance: none; appearance: none; width: 100%; height: 8px;
            background: var(--bg-color); outline: none; border-radius: 4px;
            box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light);
        }
        .neumorphic-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: var(--accent-color); cursor: pointer;
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }
        .neumorphic-slider::-moz-range-thumb {
            width: 20px; height: 20px; border-radius: 50%;
            background: var(--accent-color); cursor: pointer; border: none;
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
        }

        .project-gallery { 
            display: flex; 
            flex-direction: column; 
            overflow-y: auto; 
            padding-right: 1rem; /* Space for scrollbar */
        }

        @media (max-width: 1024px) {
            .project-gallery {
                padding-right: 0; /* No padding on small screens */
            }
        }

        .active-filters { 
            margin-bottom: 1.5rem; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.75rem; 
            padding: 0.5rem; 
            min-height: 40px; 
        }
        .filter-pill {
            display: inline-flex; align-items: center; padding: 0.5rem 1rem;
            background: var(--bg-color); border-radius: 20px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            font-size: 0.9rem; color: var(--text-color);
        }
        .filter-pill span { font-weight: 500; text-transform: capitalize; }
        .filter-pill button {
            background: none; border: none; margin-left: 0.75rem; cursor: pointer;
            font-size: 1.2rem; color: var(--text-color-light); padding: 0; line-height: 1;
            transition: color 0.2s ease;
        }
        .filter-pill button:hover { color: var(--accent-color); }

        .project-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Responsive grid */
            gap: 2rem; 
            grid-auto-rows: max-content;
        }

        .project-card {
            background: var(--bg-color); border-radius: 15px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
            overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer; display: flex; flex-direction: column;
            position: relative;
        }
        .project-card:hover { transform: translateY(-5px); box-shadow: 12px 12px 20px var(--shadow-dark), -12px -12px 20px var(--shadow-light); }
        
        /* Card Variants */
        .project-card.featured {
            background: var(--featured-gradient);
            color: var(--featured-text);
            grid-column: span 2;
        }
        .project-card.featured .project-card-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        .project-card.featured .card-tag {
            background: rgba(255, 255, 255, 0.2);
            color: var(--featured-text);
        }
        .project-card.featured h3 {
            color: var(--featured-text);
            font-size: 1.4rem;
        }
        
        .project-card.tall {
            grid-row: span 2;
        }
        .project-card.tall img {
            height: 280px;
        }
        
        .project-card.wide {
            grid-column: span 2;
        }
        .project-card.wide .project-card-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            align-items: start;
        }
        .project-card img { 
            width: 100%; 
            height: 180px; 
            object-fit: cover; 
            display: block; 
            border-top-left-radius: 15px; /* Match card border radius */
            border-top-right-radius: 15px;
        }
        .project-card-content { padding: 1.5rem; flex-grow: 1; }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .project-card h3 { 
            margin: 0; 
            color: var(--text-color); 
            font-size: 1.2rem; 
            flex: 1;
        }
        
        .card-year {
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .card-description { 
            margin: 0 0 1rem 0; 
            font-size: 0.95rem; 
            line-height: 1.5; 
            color: var(--text-color-light);
        }
        
        .card-role {
            font-size: 0.85rem;
            color: var(--accent-color);
            font-weight: 500;
            margin-bottom: 1rem;
            font-style: italic;
        }
        
        .card-tags { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 0.5rem; 
            font-size: 0.8rem; 
            margin-bottom: 1rem;
        }
        
        .card-tag { 
            background: #d1d9e6; 
            padding: 0.25rem 0.5rem; 
            border-radius: 5px; 
            color: var(--text-color);
            text-transform: capitalize;
        }
        
        .card-medium {
            background: var(--accent-color);
            color: white;
            font-weight: 600;
        }
        
        .card-tech-stack {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            font-size: 0.8rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--scroll-bar-color);
        }
        
        .tech-label {
            color: var(--text-color-light);
            font-weight: 500;
            font-size: 0.75rem;
        }
        
        .card-tech-tag {
            background: var(--bg-color);
            color: var(--text-color);
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .project-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-live { background: #10b981; color: white; }
        .status-development { background: #f59e0b; color: white; }
        .status-concept { background: #6b7280; color: white; }
        
        .tech-more {
            color: var(--text-color-light);
            font-size: 0.7rem;
            font-style: italic;
        }
        
        .card-gallery-section {
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--scroll-bar-color);
        }
        
        .gallery-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            background: var(--accent-color);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .gallery-btn:hover {
            box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
            transform: translateY(-2px);
        }
        
        /* --- DETAIL VIEW / CASE STUDY STYLES --- */
        #detail-view {
            max-width: 1200px;
            margin: 0 auto;
        }

        .case-study-container {
            display: grid;
            grid-template-columns: 240px 1fr; /* Default desktop layout */
            gap: 3rem;
            align-items: start;
        }

        /* Responsive adjustments for case study container */
        @media (max-width: 1024px) {
            .case-study-container {
                grid-template-columns: 1fr; /* Stack nav and content on smaller screens */
            }
        }
        
        .case-study-nav {
            position: sticky; /* Sticky navigation for case study */
            top: 2rem;
            align-self: start; /* Align to the top of its grid area */
        }

        @media (max-width: 1024px) {
            .case-study-nav {
                position: static; /* Remove sticky on small screens */
                margin-bottom: 2rem;
            }
            .case-study-nav ul {
                display: flex; /* Make nav items horizontal on small screens */
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            .case-study-nav li {
                flex-shrink: 0; /* Prevent items from shrinking too much */
            }
        }

        .case-study-nav ul {
            list-style: none;
            padding: 1rem;
            margin: 0;
            border-radius: 15px;
            box-shadow: 9px 9px 16px var(--shadow-dark), -9px -9px 16px var(--shadow-light);
        }
        
        .case-study-nav li a {
            display: block;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--text-color-light);
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .case-study-nav li a:hover {
            background-color: #d1d9e6;
            color: var(--text-color);
        }

        .case-study-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--text-color);
            margin: 3rem 0 2rem 0;
            font-weight: 600;
            line-height: 1.3;
            position: relative;
        }
        .case-study-content h2::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent-color);
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .case-study-content h2 {
                font-size: 2rem;
            }
        }
        
        .case-study-content .section {
            margin-bottom: 4rem;
        }
        
        .hero-section img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }

        .title-block { margin: 2rem 0; }
        .title-block h1 { 
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem; 
            color: var(--text-color); 
            margin: 0 0 0.5rem 0; 
            font-weight: 700;
            line-height: 1.2;
        }
        .title-block .pitch { font-size: 1.25rem; }

        @media (max-width: 768px) {
            .title-block h1 {
                font-size: 2.5rem;
            }
            .title-block .pitch {
                font-size: 1rem;
            }
        }
        
        .key-info-block {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            gap: 2rem;
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
        }
        .info-item { flex: 1; min-width: 150px; } /* Ensure items don't get too small */
        .info-item h4 { margin: 0 0 0.5rem 0; color: var(--text-color); }
        .info-item p { margin: 0; }
        .info-item .btn-link {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            text-decoration: none;
            color: var(--accent-color);
            font-weight: 600;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
        }
        .info-item .btn-link:hover {
             box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }
        
        .narrative-block {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two columns for text and image */
            gap: 2rem;
            align-items: center;
        }

        @media (max-width: 768px) {
            .narrative-block {
                grid-template-columns: 1fr; /* Stack on smaller screens */
            }
            .narrative-block img {
                order: -1; /* Place image above text for better flow on mobile */
            }
        }

        .narrative-block img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light); /* Add shadow to narrative images */
        }
        
        .tech-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .tech-tag {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            font-weight: 500;
            color: var(--text-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }
        .stat-item {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }
        .stat-item .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-family: 'Inter', sans-serif;
        }
        .stat-item .stat-label {
            font-size: 1rem;
            color: var(--text-color);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .quote-block {
            margin: 3rem 0;
            padding: 2rem;
            border-radius: 15px;
            background: var(--bg-color);
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            position: relative;
        }
        .quote-block::before {
            content: '"';
            font-size: 6rem;
            font-family: 'Playfair Display', serif;
            color: var(--accent-color);
            position: absolute;
            top: -1rem;
            left: 1rem;
            opacity: 0.3;
        }
        .quote-block p {
            font-style: italic;
            font-size: 1.2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        .quote-block cite {
            color: var(--text-color-light);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .back-to-gallery {
            display: inline-block;
            margin-bottom: 2rem;
            padding: 0.75rem 1.5rem;
            background: var(--bg-color);
            color: var(--text-color);
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
        }
        .back-to-gallery:hover {
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }

        /* --- MODAL STYLES --- */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(224, 229, 236, 0.85);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            padding: 2.5rem;
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: 9px 9px 16px var(--shadow-dark), -9px -9px 16px var(--shadow-light);
            color: var(--text-color);
            width: 90%;
            max-width: 700px;
            position: relative;
            line-height: 1.6;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-color-light);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover {
            color: var(--text-color);
        }
        .modal-content h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin: 0 0 1rem 0;
            color: var(--text-color);
            font-weight: 600;
        }
        .modal-content p {
            color: var(--text-color-light);
            margin-bottom: 1.5rem;
        }
        .modal-content strong {
            color: var(--text-color);
        }
        .contact-links {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        .contact-links a {
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            color: var(--accent-color);
            font-weight: 600;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
        }
        .contact-links a:hover {
            box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light);
        }

        /* --- IMAGE GALLERY MODAL STYLES --- */
        .gallery-modal-overlay {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(224, 229, 236, 0.95);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .gallery-modal-content {
            padding: 2rem;
            background: var(--bg-color);
            border-radius: 20px;
            box-shadow: 9px 9px 16px var(--shadow-dark), -9px -9px 16px var(--shadow-light);
            color: var(--text-color);
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            position: relative;
            overflow: hidden;
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--scroll-bar-color);
        }
        
        .gallery-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }
        
        .gallery-close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-color-light);
            cursor: pointer;
            transition: color 0.2s ease;
            padding: 0.5rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-close-btn:hover {
            color: var(--text-color);
            background: rgba(0, 0, 0, 0.05);
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .gallery-grid::-webkit-scrollbar {
            width: 8px;
        }
        
        .gallery-grid::-webkit-scrollbar-track {
            background: var(--scroll-bar-color);
            border-radius: 10px;
        }
        
        .gallery-grid::-webkit-scrollbar-thumb {
            background: var(--scroll-thumb-color);
            border-radius: 10px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            min-height: 200px;
            max-height: 300px;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 8px 8px 15px var(--shadow-dark), -8px -8px 15px var(--shadow-light);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            min-height: 200px;
        }
        
        .gallery-item-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .gallery-item-dimensions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .gallery-item:hover .gallery-item-overlay {
            transform: translateY(0);
        }
        
        .gallery-item-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
        }
        
        .gallery-item-description {
            font-size: 0.8rem;
            margin: 0.25rem 0 0 0;
            opacity: 0.9;
        }
        
        .gallery-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--scroll-bar-color);
        }
        
        .gallery-nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            box-shadow: 3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
            transition: all 0.2s ease;
        }
        
        .gallery-nav-btn:hover {
            box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
            color: var(--accent-color);
        }
        
        .gallery-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .gallery-info {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-color-light);
        }

        /* General mobile padding adjustment */
        @media (max-width: 768px) {
            .view {
                padding: 1rem;
            }
            
            .project-grid {
                grid-template-columns: 1fr;
            }
            
            .case-study-content h1 {
                font-size: 2.5rem;
            }
            
            .case-study-content h2 {
                font-size: 2rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 2rem;
            }
        }

    </style>
</head>
<body>

    <!-- GALLERY VIEW: Displays all portfolio projects with filtering options -->
    <div id="gallery-view" class="view">
        <div class="portfolio-container">
            <!-- Filter Sidebar: Allows users to filter projects by various criteria -->
            <aside class="filter-sidebar">
                <div class="sidebar-header">
                    <h1 id="open-about-modal">Ray Swan</h1>
                    <p id="open-contact-modal">rayswan.org</p>
                </div>
                <h2>Filters</h2>
                <!-- Natural Language Search Section -->
                <div class="search-section">
                    <input type="text" id="natural-search-input" placeholder="Search projects..." class="neumorphic-input">
                    <button id="natural-search-button" class="neumorphic-button">Search</button>
                    <div id="search-loading" style="display: none; text-align: center; margin-top: 1rem;">Loading...</div>
                    <div id="guided-results-container" class="guided-results-container">
                        <!-- Guided search results will be injected here -->
                    </div>
                </div>

                <!-- Medium Filter (Radio buttons) -->
                <details class="facet-group" open><summary>Medium</summary><div class="facet-content"><ul id="medium-filter-list"></ul></div></details>
                <!-- Genre Filter (Checkboxes) -->
                <details class="facet-group" open><summary>Genre</summary><div class="facet-content"><ul id="genre-filter-list"></ul></div></details>
                <!-- Technology Filter (Checkboxes) -->
                <details class="facet-group" open><summary>Technology</summary><div class="facet-content"><ul id="tech-filter-list"></ul></div></details>
                <!-- Style / Theme Filter (Checkboxes) -->
                <details class="facet-group" open><summary>Style / Theme</summary><div class="facet-content"><ul id="style-filter-list"></ul></div></details>
                <!-- Mood Filter (Radio buttons) -->
                <details class="facet-group"><summary>Mood</summary><div class="facet-content"><ul id="mood-filter-list"></ul></div></details>
                <!-- Year Filter (Slider) -->
                <details class="facet-group"><summary>Year</summary><div class="facet-content slider-container"><label for="year-filter" class="slider-label"><span>After:</span><span id="year-value">2020</span></label><input type="range" id="year-filter" class="neumorphic-slider" name="year" min="2020" max="2024" value="2020"></div></details>
            </aside>
            <!-- Project Gallery Main Content -->
            <main class="project-gallery">
                <!-- Displays active filter pills for easy removal -->
                <nav class="active-filters" aria-label="Selected Filters" id="active-filters-container"></nav>
                <!-- Grid container for project cards -->
                <div class="project-grid" id="project-grid-container"></div>
            </main>
        </div>
    </div>

    <!-- DETAIL VIEW (Initially Hidden): Displays a detailed case study for a selected project -->
    <div id="detail-view" class="view" style="display: none;">
        <!-- Button to navigate back to the gallery view -->
        <div class="back-to-gallery" id="back-to-gallery-btn">← Back to Gallery</div>
        <div class="case-study-container">
            <!-- Case Study Navigation: Links to different sections within the case study -->
            <nav class="case-study-nav">
                <ul>
                    <li><a href="#section-overview">Overview</a></li>
                    <li><a href="#section-process">The Process</a></li>
                    <li><a href="#section-tech">Tech Details</a></li>
                    <li><a href="#section-outcome">Outcome</a></li>
                </ul>
            </nav>
            <!-- Case Study Content Area -->
            <main class="case-study-content">
                <!-- Overview Section -->
                <section id="section-overview" class="section">
                    <div class="hero-section">
                        <img id="detail-hero-img" src="" alt="Project hero image">
                    </div>
                    <div class="title-block">
                        <h1 id="detail-title"></h1>
                        <p id="detail-pitch" class="pitch"></p>
                    </div>
                    <div class="key-info-block">
                        <div class="info-item">
                            <h4>My Role</h4>
                            <p id="detail-role"></p>
                        </div>
                        <div class="info-item">
                            <h4>Year</h4>
                            <p id="detail-year"></p>
                        </div>
                        <div class="info-item">
                            <h4>Links</h4>
                            <div id="detail-links"></div>
                        </div>
                    </div>
                </section>

                <!-- Process Section -->
                <section id="section-process" class="section">
                    <h2>The Process</h2>
                    <div class="narrative-block">
                        <div>
                            <h3>The Challenge & Vision</h3>
                            <p id="detail-challenge"></p>
                        </div>
                        <img id="detail-process-img1" src="https://placehold.co/600x400/94a3b8/ffffff?text=Moodboard" alt="Process visual">
                    </div>
                     <div class="narrative-block" style="margin-top: 2rem;">
                        <img id="detail-process-img2" src="https://placehold.co/600x400/64748b/ffffff?text=Wireframe" alt="Process visual">
                        <div>
                            <h3>Design & Development</h3>
                            <p id="detail-development"></p>
                        </div>
                    </div>
                </section>

                <!-- Technical Details Section -->
                <section id="section-tech" class="section">
                    <h2>Key Technical Details</h2>
                    <div id="detail-tech-tags" class="tech-tags-container"></div>
                </section>

                <!-- Outcome Section -->
                <section id="section-outcome" class="section">
                    <h2>Outcome & Reflection</h2>
                    <p id="detail-outcome"></p>
                </section>
            </main>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-modal-id="about-modal">&times;</button>
            <h3>I don't just build the shell. I bring the soul.</h3>
            <p><strong>I'm a Synthesist</strong> — a multi-disciplinary creator who blends technology, narrative, and design into experiences that feel alive.</p>
            <p>For me, the story is never separate from the system — every line of code, every brushstroke, every word exists to move someone. My career reflects this philosophy. I began in educational video games, moving from technical support to artist, then animator, and finally producing titles. That early work taught me how to see every role as part of the same creative whole.</p>
            <p>From there, I directed software development at a finance firm while earning my master's in humanities — pairing technical leadership with a deep understanding of culture and story. This combination of rigor and imagination is at the heart of how I approach every project.</p>
            <p>Today, I see technology and storytelling not as parallel tracks but as collaborators. With the rise of AI and emergent tools, I craft software with its own narrative voice — allowing technology itself to become a character, an agent, within immersive worlds.</p>
            <p>This site is my stage. A place where all my disciplines — code, art, writing — come together to speak in unison.</p>
            <p><strong>I don't just deliver projects. I build experiences that resonate.</strong></p>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contact-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-modal-id="contact-modal">&times;</button>
            <h3>Let's talk about what we can build — and bring to life — together.</h3>
            <p>I work with people who see the bigger picture. People who understand that the best systems tell stories, and the best stories are built on solid systems.</p>
            <p>Whether you're here to talk about a technical challenge, a creative commission, or simply to explore what's possible when disciplines intersect — I'd love to hear from you.</p>
            <div class="contact-links">
                <a href="mailto:your-email@example.com">Start a Conversation &rarr;</a>
                <p>or connect with me directly on:</p>
                <div>
                    <a href="#" style="margin-right: 1rem;">LinkedIn</a>
                    <a href="#">GitHub</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Gallery Modal -->
    <div id="gallery-modal" class="gallery-modal-overlay">
        <div class="gallery-modal-content">
            <div class="gallery-header">
                <h3 class="gallery-title" id="gallery-modal-title">Art Gallery</h3>
                <button class="gallery-close-btn" data-modal-id="gallery-modal-overlay">&times;</button>
            </div>
            <div class="gallery-grid" id="gallery-modal-grid">
                <!-- Gallery items will be dynamically populated -->
            </div>
            <div class="gallery-controls">
                <button class="gallery-nav-btn" id="gallery-prev-btn">← Previous</button>
                <button class="gallery-nav-btn" id="gallery-next-btn">Next →</button>
            </div>
            <div class="gallery-info" id="gallery-info">
                <!-- Gallery info will be dynamically populated -->
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA SOURCE ---
    // Array of project objects, each containing details for both gallery and case study views.
    const projects = [
        { 
            id: 1, 
            title: "AI Tarot Reader", 
            description: "An interactive web app using generative AI to provide mystical tarot readings with personalized interpretations.", 
            imageUrl: "https://placehold.co/600x400/334155/ffffff?text=AI+Tarot", 
            medium: "code", 
            genre: ["ai-agent", "tarot", "web-app"], 
            style: ["minimalist", "modern"], 
            tech: ["JavaScript", "HTML5", "CSS Grid", "Gemini API"],
            mood: ["mystical", "contemplative"], 
            year: 2024, 
            status: "live",
            variant: "featured",
            role: "Lead Developer, UX Designer", 
            links: { "Live Site": "#" }, 
            pitch: "Combining ancient symbolism with modern AI to create a personal divination experience.", 
            challenge: "The primary challenge was to create an AI that didn't just give generic answers, but provided nuanced, context-aware interpretations of tarot spreads, making the experience feel authentic and personal.", 
            development: "Using a fine-tuned language model, I developed a system that understands the relationships between cards. The front-end, built with vanilla JS, focuses on a clean, meditative user experience to complement the mystical theme.", 
            outcome: "The final app saw high user engagement, with an average session duration of over 5 minutes. It was praised for its intuitive interface and the depth of its AI-generated readings."
        },
        { 
            id: 2, 
            title: "Procedural Landscape Generator", 
            description: "A Three.js application that creates infinite, explorable landscapes using Perlin noise and procedural generation.", 
            imageUrl: "https://placehold.co/600x400/166534/ffffff?text=3D+Landscape", 
            medium: "code", 
            genre: ["generative-art", "3d", "interactive"], 
            style: ["organic", "abstract"], 
            tech: ["Three.js", "WebGL", "JavaScript"],
            mood: ["serene", "exploratory"], 
            year: 2024, 
            status: "live",
            variant: "tall",
            role: "Full-Stack Developer, Creative Technologist", 
            links: { "Live Demo": "#", "GitHub": "#" }, 
            pitch: "Creating infinite, explorable worlds through procedural generation and real-time 3D rendering.", 
            challenge: "The challenge was to create landscapes that felt both infinite and coherent, using mathematical algorithms to generate terrain that was both visually appealing and performant in real-time.", 
            development: "Built with Three.js and WebGL, the system uses Perlin noise algorithms to generate terrain, with real-time lighting and atmospheric effects. The user can explore the landscape in first-person view.", 
            outcome: "The application demonstrates the potential of procedural generation for creating immersive digital environments, with smooth performance even on mobile devices."
        },
        { 
            id: 3, 
            title: "Digital Collage Series", 
            description: "A collection of surreal digital collages exploring themes of identity and transformation in the digital age.", 
            imageUrl: "https://placehold.co/600x400/1e293b/ffffff?text=Digital+Art", 
            medium: "art", 
            genre: ["digital-art", "collage", "conceptual"], 
            style: ["surreal", "abstract"], 
            tech: ["Photoshop", "Procreate"],
            mood: ["contemplative", "mysterious"], 
            year: 2023, 
            status: "live",
            role: "Digital Artist, Conceptual Designer", 
            links: { "View Gallery": "#" }, 
            pitch: "Exploring the intersection of human identity and digital transformation through surreal visual narratives.", 
            challenge: "Creating a cohesive visual language that captures the essence of digital identity while maintaining artistic integrity and emotional depth.", 
            development: "The series evolved through multiple phases, starting with traditional collage techniques and progressing through digital manipulation to create surreal, dreamlike compositions.", 
            outcome: "The collection has been featured in several digital art exhibitions and has received recognition for its innovative approach to contemporary themes."
        },
        { 
            id: 4, 
            title: "Interactive Poetry Engine", 
            description: "An AI-powered web application that generates contextual poetry based on user emotions and environmental data.", 
            imageUrl: "https://placehold.co/600x400/7c2d12/ffffff?text=Poetry+AI", 
            medium: "code", 
            genre: ["ai-agent", "poetry", "web-app"], 
            style: ["literary", "minimalist"], 
            tech: ["OpenAI API", "Node.js", "React"],
            mood: ["contemplative", "inspiring"], 
            year: 2024, 
            status: "development",
            variant: "wide",
            role: "Full-Stack Developer, AI Engineer", 
            links: { "GitHub": "#", "Demo": "#" }, 
            pitch: "Creating poetry that responds to human emotion and environmental context through AI.", 
            challenge: "The challenge was to create an AI system that could generate poetry that felt authentic and emotionally resonant, rather than generic or mechanical.", 
            development: "Built with React and Node.js, the system uses sentiment analysis and environmental data to generate contextual poetry. The AI model was fine-tuned on classical and contemporary poetry.", 
            outcome: "The application has been praised for its ability to create poetry that feels personal and meaningful, with users reporting emotional connections to the generated work."
        },
        { 
            id: 5, 
            title: "Papi Chispa Cartas del Deseo", 
            description: "A comprehensive collection of tarot-inspired digital art and mystical designs.", 
            imageUrl: "./images/uploads/projects/papi-chispa/papi.jpg", 
            medium: "art", 
            genre: ["digital-art", "tarot"], 
            style: ["mystical", "spiritual"], 
            tech: ["Photoshop", "Procreate", "Digital Painting"],
            mood: ["serene", "mystical"], 
            year: 2024, 
            status: "live",
            role: "Digital Artist, Mystical Designer", 
            links: { "View Gallery": "#" }, 
            pitch: "Exploring the intersection of ancient wisdom and modern digital art through tarot-inspired designs.", 
            challenge: "Creating a cohesive visual language that captures the essence of tarot symbolism while maintaining artistic integrity and spiritual depth.", 
            development: "The collection evolved through multiple phases, starting with traditional tarot research and progressing through digital sketches to final mystical artworks. Each piece explores different aspects of tarot archetypes.", 
            outcome: "The collection has been well-received for its innovative approach to mystical aesthetics and spiritual symbolism.", 
            gallery: [
                { url: "./images/uploads/projects/papi-chispa/papi.jpg", title: "Papi Chispa", description: "Main tarot card design", dimensions: "auto" }
            ]
        }
    ];

    // --- DOM ELEMENT REFERENCES ---
    const galleryView = document.getElementById('gallery-view');
    const detailView = document.getElementById('detail-view');
    const projectGrid = document.getElementById('project-grid-container');
    const activeFiltersContainer = document.getElementById('active-filters-container');
    const filterLists = { 
        medium: document.getElementById('medium-filter-list'), 
        genre: document.getElementById('genre-filter-list'), 
        style: document.getElementById('style-filter-list'), 
        mood: document.getElementById('mood-filter-list'),
        tech: document.getElementById('tech-filter-list')
    };
    const yearSlider = document.getElementById('year-filter');
    const yearValueSpan = document.getElementById('year-value');
    const sidebar = document.querySelector('.filter-sidebar');
    const backToGalleryBtn = document.getElementById('back-to-gallery-btn');

    // New DOM references for natural language search
    const naturalSearchInput = document.getElementById('natural-search-input');
    const naturalSearchButton = document.getElementById('natural-search-button');
    const searchLoading = document.getElementById('search-loading');
    const guidedResultsContainer = document.getElementById('guided-results-container');

    // Modal references
    const openAboutBtn = document.getElementById('open-about-modal');
    const openContactBtn = document.getElementById('open-contact-modal');
    const aboutModal = document.getElementById('about-modal');
    const contactModal = document.getElementById('contact-modal');
    const closeButtons = document.querySelectorAll('.modal-close-btn');
    
    // Gallery modal references
    const galleryModal = document.getElementById('gallery-modal');
    const galleryModalTitle = document.getElementById('gallery-modal-title');
    const galleryModalGrid = document.getElementById('gallery-modal-grid');
    const galleryInfo = document.getElementById('gallery-info');
    const galleryPrevBtn = document.getElementById('gallery-prev-btn');
    const galleryNextBtn = document.getElementById('gallery-next-btn');
    
    // Gallery state
    let currentGallery = null;
    let currentGalleryIndex = 0;
    const itemsPerPage = 12;


    // --- STATE MANAGEMENT ---
    // `activeFilters` object holds the current filter selections.
    let activeFilters = { 
        medium: [], 
        genre: [], 
        style: [], 
        mood: [], 
        year: parseInt(yearSlider.value, 10), // Initialize with slider's default value
        tech: []
    };

    // --- HELPER FUNCTIONS FOR FILTER MANAGEMENT ---

    /**
     * Resets all filter values to their default states.
     */
    function resetAllFilters() {
        activeFilters.medium = [];
        activeFilters.genre = [];
        activeFilters.style = [];
        activeFilters.mood = [];
        activeFilters.year = parseInt(yearSlider.min, 10);
        activeFilters.tech = [];

        // Visually reset all filter controls
        document.querySelectorAll('input[name="medium"]').forEach(input => input.checked = false);
        document.querySelectorAll('input[name="genre"]').forEach(input => input.checked = false);
        document.querySelectorAll('input[name="style"]').forEach(input => input.checked = false);
        document.querySelectorAll('input[name="mood"]').forEach(input => input.checked = false);
        document.querySelectorAll('input[name="tech"]').forEach(input => input.checked = false);
        yearSlider.value = yearSlider.min;
        yearValueSpan.textContent = yearSlider.min;
    }

    /**
     * Updates the UI elements (checkboxes, radio buttons, slider) to reflect the current activeFilters state.
     */
    function updateFilterUI() {
        // Update Medium checkboxes
        document.querySelectorAll('input[name="medium"]').forEach(input => {
            input.checked = activeFilters.medium.includes(input.value);
        });

        // Update Genre, Style, Tech, and Mood checkboxes
        ['genre', 'style', 'tech', 'mood'].forEach(type => {
            document.querySelectorAll(`input[name="${type}"]`).forEach(input => {
                input.checked = activeFilters[type].includes(input.value);
            });
        });

        // Update Year slider
        yearSlider.value = activeFilters.year;
        yearValueSpan.textContent = activeFilters.year;
    }


    // --- RENDER FUNCTIONS ---

    /**
     * Renders project cards into the project grid based on the provided array.
     * @param {Array<Object>} projectsToRender - The array of project objects to display.
     */
    function renderProjects(projectsToRender) {
        projectGrid.innerHTML = ''; // Clear existing projects
        if (projectsToRender.length === 0) {
            projectGrid.innerHTML = '<p style="text-align: center; color: var(--text-color);">No projects match the selected filters.</p>';
            return;
        }
        projectsToRender.forEach(project => {
            const card = document.createElement('div');
            card.className = `project-card ${project.variant || ''}`;
            card.dataset.id = project.id; // Store project ID for detail view navigation
            
            // Create tech stack display
            const techStack = project.tech ? project.tech.slice(0, 3).map(tech => 
                `<span class="card-tech-tag">${tech}</span>`
            ).join('') : '';
            
            // Create role display
            const roleDisplay = project.role ? `<div class="card-role">${project.role}</div>` : '';
            
            // Create year display
            const yearDisplay = project.year ? `<div class="card-year">${project.year}</div>` : '';
            
            // Create gallery button if project has gallery
            const galleryButton = project.gallery ? 
                `<button class="gallery-btn" data-project-id="${project.id}">View Gallery (${project.gallery.length})</button>` : '';
            
            // Create status badge
            const statusBadge = project.status ? `<div class="project-status status-${project.status}">${project.status}</div>` : '';
            
            card.innerHTML = `
                <img src="${project.imageUrl}" alt="${project.title}">
                <div class="project-card-content">
                    <div class="card-header">
                        <h3>${project.title}</h3>
                        ${yearDisplay}
                    </div>
                    <p class="card-description">${project.description}</p>
                    ${roleDisplay}
                    <div class="card-tags">
                        <span class="card-tag card-medium">${project.medium}</span>
                        ${project.genre.map(g => `<span class="card-tag">${g.replace('-', ' ')}</span>`).join('')}
                    </div>
                    ${techStack ? `<div class="card-tech-stack">
                        <span class="tech-label">Tech:</span>
                        ${techStack}
                        ${project.tech && project.tech.length > 3 ? `<span class="tech-more">+${project.tech.length - 3} more</span>` : ''}
                    </div>` : ''}
                    ${galleryButton ? `<div class="card-gallery-section">${galleryButton}</div>` : ''}
                </div>
                ${statusBadge}
            `;
            projectGrid.appendChild(card);
        });
    }
    
    /**
     * Populates the detail view with information from a specific project.
     * @param {Object} project - The project object to display in detail.
     */
    function renderDetailPage(project) {
        if (!project) return;
        
        // Populate all static detail page elements
        document.getElementById('detail-hero-img').src = project.imageUrl;
        document.getElementById('detail-title').textContent = project.title;
        document.getElementById('detail-pitch').textContent = project.pitch;
        document.getElementById('detail-role').textContent = project.role;
        document.getElementById('detail-year').textContent = project.year;
        document.getElementById('detail-challenge').textContent = project.challenge;
        document.getElementById('detail-development').textContent = project.development;
        document.getElementById('detail-outcome').textContent = project.outcome;

        // Populate Links dynamically
        const linksContainer = document.getElementById('detail-links');
        linksContainer.innerHTML = ''; // Clear existing links
        for (const [text, url] of Object.entries(project.links)) {
            const link = document.createElement('a');
            link.href = url;
            link.textContent = text;
            link.className = 'btn-link';
            link.target = '_blank'; // Open links in a new tab
            link.rel = 'noopener noreferrer'; // Security best practice for target="_blank"
            linksContainer.appendChild(link);
        }
        
        // Populate Tech Tags dynamically
        const techTagsContainer = document.getElementById('detail-tech-tags');
        techTagsContainer.innerHTML = ''; // Clear existing tags
        project.tech.forEach(tech => {
            const tag = document.createElement('div');
            tag.className = 'tech-tag';
            tag.textContent = tech;
            techTagsContainer.appendChild(tag);
        });
    }

    /**
     * Renders the active filter pills at the top of the project gallery.
     */
    function renderActiveFilterPills() {
        activeFiltersContainer.innerHTML = ''; // Clear existing pills
        Object.entries(activeFilters).forEach(([type, value]) => {
            // Handle 'medium' filter pill
            if (type === 'medium' && value !== 'all') {
                const pill = document.createElement('div');
                pill.className = 'filter-pill';
                pill.innerHTML = `<span>${value}</span><button data-filter-type="medium" data-filter-value="${value}" aria-label="Remove ${value} filter">×</button>`;
                activeFiltersContainer.appendChild(pill);
            } 
            // Handle 'mood' filter pill
            else if (type === 'mood' && value !== 'all') {
                const pill = document.createElement('div');
                pill.className = 'filter-pill';
                pill.innerHTML = `<span>Mood: ${value}</span><button data-filter-type="mood" data-filter-value="${value}" aria-label="Remove mood ${value} filter">×</button>`;
                activeFiltersContainer.appendChild(pill);
            } 
            // Handle 'year' filter pill (only if year is greater than default min)
            else if (type === 'year' && value > parseInt(yearSlider.min, 10)) {
                const pill = document.createElement('div');
                pill.className = 'filter-pill';
                pill.innerHTML = `<span>After ${value}</span><button data-filter-type="year" data-filter-value="${value}" aria-label="Remove year filter">×</button>`;
                activeFiltersContainer.appendChild(pill);
            } 
            // Handle array-based filters (genre, style)
            else if (Array.isArray(value)) {
                value.forEach(item => {
                    const pill = document.createElement('div');
                    pill.className = 'filter-pill';
                    pill.innerHTML = `<span>${item.replace('-', ' ')}</span><button data-filter-type="${type}" data-filter-value="${item}" aria-label="Remove ${item.replace('-', ' ')} ${type} filter">×</button>`;
                    activeFiltersContainer.appendChild(pill);
                });
            }
        });
    }

    /**
     * Renders the filter facets (checkboxes/radio buttons) and their counts.
     * Facets are dynamically generated based on available projects after filtering.
     * @param {Array<Object>} availableProjects - Projects that currently match filters, used for counting.
     */
    function renderFacets(availableProjects) {
        // Determine the pool of projects to count against (all projects if medium is 'all', otherwise filtered by selected medium)
        const facetPool = activeFilters.medium === 'all' ? projects : projects.filter(p => p.medium === activeFilters.medium);

        // Render Medium filter
        const mediumCounts = projects.reduce((acc, p) => ({ ...acc, [p.medium]: (acc[p.medium] || 0) + 1 }), { all: projects.length });
        filterLists.medium.innerHTML = ['all', 'code', 'art', 'writing'].map(m => `
            <li>
                <label class="neumorphic-control">
                    <input type="radio" name="medium" value="${m}" ${activeFilters.medium === m ? 'checked' : ''}>
                    <span class="checkmark"></span>
                    <span style="text-transform: capitalize;">${m}</span>
                    <span class="facet-count">${mediumCounts[m] || 0}</span>
                </label>
            </li>
        `).join('');

        // Render Genre, Style, and Tech filters (checkboxes)
        ['genre', 'style', 'tech'].forEach(type => {
            const counts = availableProjects.reduce((acc, p) => { 
                (p[type] || []).forEach(v => { acc[v] = (acc[v] || 0) + 1; }); 
                return acc; 
            }, {});
            // Get all unique values for the current facet type from the facetPool
            const allValues = [...new Set(facetPool.flatMap(p => p[type] || []))].sort();
            filterLists[type].innerHTML = allValues.map(v => {
                const count = counts[v] || 0;
                // Only show facet if it has projects or is currently active
                if (count === 0 && !activeFilters[type].includes(v)) return ''; 
                return `
                    <li>
                        <label class="neumorphic-control">
                            <input type="checkbox" name="${type}" value="${v}" ${activeFilters[type].includes(v) ? 'checked' : ''}>
                            <span class="checkmark"></span>
                            <span style="text-transform: capitalize;">${v.replace('-', ' ')}</span>
                            <span class="facet-count">${count}</span>
                        </label>
                    </li>
                `;
            }).join('');
        });

        // Render Mood filter (radio buttons)
        const moodCounts = availableProjects.reduce((acc, p) => ({ ...acc, [p.mood]: (acc[p.mood] || 0) + 1 }), {});
        // Get all unique mood values from the facetPool, plus 'all' option
        const allMoods = ['all', ...[...new Set(facetPool.map(p => p.mood))].sort()];
        filterLists.mood.innerHTML = allMoods.map(m => {
            const count = m === 'all' ? availableProjects.length : moodCounts[m] || 0;
            // Only show mood if it has projects or is 'all'
            if (count === 0 && m !== 'all') return ''; 
            return `
                <li>
                    <label class="neumorphic-control">
                        <input type="radio" name="mood" value="${m}" ${activeFilters.mood === m ? 'checked' : ''}>
                        <span class="checkmark"></span>
                        <span style="text-transform: capitalize;">${m}</span>
                        <span class="facet-count">${count}</span>
                    </label>
                </li>
            `;
        }).join('');
    }

    /**
     * Renders clickable guided search result pills.
     * @param {Array<Object>} suggestions - Array of { label, filters } objects from Gemini.
     */
    function renderGuidedResults(suggestions) {
        guidedResultsContainer.innerHTML = '';
        if (!suggestions || suggestions.length === 0) {
            guidedResultsContainer.innerHTML = '<p style="font-size: 0.9rem; color: var(--text-color-light);">No suggestions found. Try a different query.</p>';
            return;
        }
        suggestions.forEach(suggestion => {
            const pill = document.createElement('div');
            pill.className = 'guided-search-pill';
            pill.textContent = suggestion.label;
            // Store the filters object as a string in a data attribute
            pill.dataset.filters = JSON.stringify(suggestion.filters); 
            guidedResultsContainer.appendChild(pill);
        });
    }

    // --- FILTERING LOGIC ---

    /**
     * Applies all active filters to the projects data and re-renders the UI.
     */
    function applyFilters() {
        const filteredProjects = projects.filter(p => {
            // Filter by year (projects must be from or after the selected year)
            if (p.year < activeFilters.year) return false;
            
            // Filter by medium (if no mediums are selected, this condition is always true)
            if (activeFilters.medium.length > 0) {
                if (!activeFilters.medium.includes(p.medium)) return false;
            }
            
            // Filter by genre (if no genres are selected, this condition is always true)
            if (activeFilters.genre.length > 0) {
                const hasMatch = activeFilters.genre.some(g => p.genre.includes(g));
                if (!hasMatch) return false;
            }
            
            // Filter by style (if no styles are selected, this condition is always true)
            if (activeFilters.style.length > 0) {
                const hasMatch = activeFilters.style.some(s => p.style.includes(s));
                if (!hasMatch) return false;
            }
            
            // Filter by tech (if no tech items are selected, this condition is always true)
            if (activeFilters.tech.length > 0) {
                const hasMatch = activeFilters.tech.some(t => p.tech.includes(t));
                if (!hasMatch) return false;
            }
            
            // Filter by mood (if no moods are selected, this condition is always true)
            if (activeFilters.mood.length > 0) {
                const hasMatch = activeFilters.mood.some(m => p.mood.includes(m));
                if (!hasMatch) return false;
            }
            
            return true;
        });
        
        renderProjects(filteredProjects);
        renderActiveFilterPills();
        renderFacets(filteredProjects); // Re-render facets to update counts based on current filters
        updateFilterUI(); // Ensure all filter controls reflect the active state
    }
    
    // --- VIEW ROUTING LOGIC ---

    /**
     * Shows the gallery view and hides the detail view.
     */
    function showGalleryView() {
        galleryView.style.display = 'block';
        detailView.style.display = 'none';
    }
    
    /**
     * Shows the detail view for a specific project and hides the gallery view.
     * @param {number} projectId - The ID of the project to display.
     */
    function showDetailView(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (project) {
            renderDetailPage(project);
            galleryView.style.display = 'none';
            detailView.style.display = 'block';
            window.scrollTo(0, 0); // Scroll to top of the page for detail view
        }
    }

    // --- GEMINI API INTEGRATION ---

    /**
     * Calls the Gemini API to get filter suggestions based on a natural language query.
     * @param {string} userQuery - The user's natural language search query.
     * @returns {Promise<Array<Object>>} A promise that resolves to an array of suggested filter objects.
     */
    async function callGeminiAPI(userQuery) {
        searchLoading.style.display = 'block';
        naturalSearchButton.disabled = true;
        guidedResultsContainer.innerHTML = ''; // Clear previous results

        // Dynamically get all unique genres and styles from the projects data
        const allGenres = [...new Set(projects.flatMap(p => p.genre))].sort();
        const allStyles = [...new Set(projects.flatMap(p => p.style))].sort();
        const allMoods = [...new Set(projects.map(p => p.mood))].sort();
        const minYear = Math.min(...projects.map(p => p.year));
        const maxYear = Math.max(...projects.map(p => p.year));

        const prompt = `You are an AI assistant for a portfolio website. Based on the user's search query, suggest 2-3 relevant filter combinations from the available options. Each suggestion should include a 'label' (a short, descriptive phrase for the user) and a 'filters' object containing the suggested filter values.

Available filters and their possible values:
- medium: ['all', 'code', 'art', 'writing']
- genre: ${JSON.stringify(allGenres)}
- tech: ${JSON.stringify([...new Set(projects.flatMap(p => p.tech || []))].sort())}
- style: ${JSON.stringify(allStyles)}
- mood: ['all', ${allMoods.map(m => `'${m}'`).join(', ')}]
- year: min ${minYear}, max ${maxYear}

User query: "${userQuery}"

Provide the response as a JSON array. Each object in the array should have a 'label' (string) and a 'filters' (object). The 'filters' object should contain properties like 'medium' (string), 'genre' (array of strings), 'tech' (array of strings), 'style' (array of strings), 'mood' (string), and 'year' (number). If a filter is not relevant, omit it from the 'filters' object.`;

        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = {
            contents: chatHistory,
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            "label": { "type": "STRING" },
                            "filters": {
                                "type": "OBJECT",
                                "properties": {
                                    "medium": { "type": "STRING", "enum": ['all', 'code', 'art', 'writing'] },
                                    "genre": { "type": "ARRAY", "items": { "type": "STRING", "enum": allGenres } },
                                    "tech": { "type": "ARRAY", "items": { "type": "STRING", "enum": [...new Set(projects.flatMap(p => p.tech || []))].sort() } },
                                    "style": { "type": "ARRAY", "items": { "type": "STRING", "enum": allStyles } },
                                    "mood": { "type": "STRING", "enum": ['all', ...allMoods] },
                                    "year": { "type": "NUMBER", "minimum": minYear, "maximum": maxYear }
                                }
                            }
                        },
                        "required": ["label", "filters"]
                    }
                }
            }
        };

        const apiKey = ""; // Canvas will automatically provide this at runtime
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const jsonText = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);
                return parsedJson;
            } else {
                console.error("Gemini API returned an unexpected structure:", result);
                return [];
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return [];
        } finally {
            searchLoading.style.display = 'none';
            naturalSearchButton.disabled = false;
        }
    }

    // --- EVENT HANDLERS ---

    /**
     * Handles changes to filter inputs (checkboxes, radio buttons, slider).
     * @param {Event} e - The change event object.
     */
    function handleFilterChange(e) {
        if (!e.target.name) return; // Ensure the element has a 'name' attribute
        const type = e.target.name;
        const value = e.target.value;

        if (type === 'medium' || type === 'mood') {
            // For single-selection filters (radio buttons)
            activeFilters[type] = value;
            // If medium changes, reset other category filters for a fresh start
            if (type === 'medium') { 
                activeFilters.genre = []; 
                activeFilters.style = []; 
                activeFilters.tech = [];
                activeFilters.mood = 'all'; 
            }
        } else if (type === 'year') {
            // For the year slider
            activeFilters.year = parseInt(value, 10);
        } else {
            // For multi-selection filters (checkboxes: genre, style, tech)
            if (e.target.checked) {
                // Add value if not already present
                if (!activeFilters[type].includes(value)) {
                    activeFilters[type].push(value);
                }
            } else {
                // Remove value
                activeFilters[type] = activeFilters[type].filter(item => item !== value);
            }
        }
        applyFilters(); // Re-apply all filters after a change
    }

    /**
     * Handles clicks on active filter pills to remove them.
     * @param {Event} e - The click event object.
     */
    function handlePillRemove(e) {
        if (e.target.tagName !== 'BUTTON') return; // Ensure a button was clicked
        const { filterType, filterValue } = e.target.dataset;

        if (filterType === 'medium' || filterType === 'mood') {
            activeFilters[filterType] = 'all'; // Reset single-selection filter to 'all'
        } else if (filterType === 'year') {
            activeFilters.year = parseInt(yearSlider.min, 10); // Reset year to its minimum
        } else {
            // Remove specific value from array-based filters
            activeFilters[filterType] = activeFilters[filterType].filter(item => item !== filterValue);
        }
        applyFilters(); // Re-apply filters after removal
    }
    
    /**
     * Handles clicks on project cards to open the detail view.
     * @param {Event} e - The click event object.
     */
    function handleProjectClick(e) {
        const card = e.target.closest('.project-card'); // Find the closest project card element
        if (card) {
            const projectId = parseInt(card.dataset.id, 10); // Get the project ID from data attribute
            showDetailView(projectId);
        }
    }

    /**
     * Handles the natural language search button click.
     */
    async function handleNaturalSearch() {
        const query = naturalSearchInput.value.trim();
        if (!query) {
            guidedResultsContainer.innerHTML = '<p style="font-size: 0.9rem; color: var(--text-color-light);">Please enter a search query.</p>';
            return;
        }
        const suggestions = await callGeminiAPI(query);
        renderGuidedResults(suggestions);
    }

    /**
     * Handles clicks on guided search result pills.
     * @param {Event} e - The click event object.
     */
    function handleGuidedResultClick(e) {
        const pill = e.target.closest('.guided-search-pill');
        if (pill && pill.dataset.filters) {
            const filtersToApply = JSON.parse(pill.dataset.filters);
            
            // Reset all current filters first to ensure a clean application of new filters
            resetAllFilters();

            // Apply the suggested filters
            if (filtersToApply.medium) activeFilters.medium = filtersToApply.medium;
            if (filtersToApply.genre) activeFilters.genre = filtersToApply.genre;
            if (filtersToApply.style) activeFilters.style = filtersToApply.style;
            if (filtersToApply.tech) activeFilters.tech = filtersToApply.tech;
            if (filtersToApply.mood) activeFilters.mood = filtersToApply.mood;
            if (filtersToApply.year) activeFilters.year = filtersToApply.year;

            applyFilters(); // Re-render everything based on new activeFilters
            guidedResultsContainer.innerHTML = ''; // Clear guided results after applying
            naturalSearchInput.value = ''; // Clear search input
        }
    }


    // --- MODAL FUNCTIONALITY ---
    function openModal(modal) {
        if (modal) modal.style.display = 'flex';
    }
    
    function closeModal(modal) {
        if (modal) modal.style.display = 'none';
    }
    
    // --- GALLERY FUNCTIONALITY ---
    function openGalleryModal(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (!project || !project.gallery) return;
        
        currentGallery = project.gallery;
        currentGalleryIndex = 0;
        
        galleryModalTitle.textContent = `${project.title} - Gallery`;
        renderGalleryPage();
        openModal(galleryModal);
    }
    
    function renderGalleryPage() {
        if (!currentGallery) return;
        
        const startIndex = currentGalleryIndex * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageItems = currentGallery.slice(startIndex, endIndex);
        
        galleryModalGrid.innerHTML = pageItems.map(item => `
            <div class="gallery-item">
                <img src="${item.url}" alt="${item.title}">
                ${item.dimensions ? `<div class="gallery-item-dimensions">${item.dimensions}</div>` : ''}
                <div class="gallery-item-overlay">
                    <h4 class="gallery-item-title">${item.title}</h4>
                    <p class="gallery-item-description">${item.description}</p>
                </div>
            </div>
        `).join('');
        
        // Update navigation buttons
        galleryPrevBtn.disabled = currentGalleryIndex === 0;
        galleryNextBtn.disabled = endIndex >= currentGallery.length;
        
        // Update info
        const totalPages = Math.ceil(currentGallery.length / itemsPerPage);
        galleryInfo.textContent = `Page ${currentGalleryIndex + 1} of ${totalPages} • ${currentGallery.length} total images`;
    }
    
    function nextGalleryPage() {
        if (currentGallery && (currentGalleryIndex + 1) * itemsPerPage < currentGallery.length) {
            currentGalleryIndex++;
            renderGalleryPage();
        }
    }
    
    function prevGalleryPage() {
        if (currentGallery && currentGalleryIndex > 0) {
            currentGalleryIndex--;
            renderGalleryPage();
        }
    }
    
    // Modal event listeners
    openAboutBtn.addEventListener('click', () => openModal(aboutModal));
    openContactBtn.addEventListener('click', () => openModal(contactModal));
    closeButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            const modalId = e.currentTarget.dataset.modalId;
            const modal = document.getElementById(modalId);
            closeModal(modal);
        });
    });
    window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal-overlay')) {
            closeModal(event.target);
        }
    });

    // --- INITIALIZATION ---
    // Attach event listeners to filter sidebar, year slider, active filters container, and project grid.
    sidebar.addEventListener('change', handleFilterChange);
    yearSlider.addEventListener('input', (e) => { 
        yearValueSpan.textContent = e.target.value; // Update year display as slider moves
    });
    yearSlider.addEventListener('change', handleFilterChange); // Apply filter when slider value is committed
    activeFiltersContainer.addEventListener('click', handlePillRemove);
    projectGrid.addEventListener('click', handleProjectClick);
    backToGalleryBtn.addEventListener('click', showGalleryView);

    // Attach event listeners for natural language search
    naturalSearchButton.addEventListener('click', handleNaturalSearch);
    naturalSearchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            handleNaturalSearch();
        }
    });
    guidedResultsContainer.addEventListener('click', handleGuidedResultClick);
    
    // Gallery event listeners
    galleryPrevBtn.addEventListener('click', prevGalleryPage);
    galleryNextBtn.addEventListener('click', nextGalleryPage);
    
    // Gallery button clicks (delegated)
    projectGrid.addEventListener('click', (e) => {
        if (e.target.classList.contains('gallery-btn')) {
            e.stopPropagation(); // Prevent project card click
            const projectId = parseInt(e.target.dataset.projectId, 10);
            openGalleryModal(projectId);
        }
    });


    // Initial render of projects and facets when the page loads.
    applyFilters();
});
</script>
</body>
</html>
